/**
 * Code is taken from Computer Networking: A Top-Down Approach Featuring 
 * the Internet, second edition, copyright 1996-2002 J.F Kurose and K.W. Ross, 
 * All Rights Reserved.
 **/

import java.io.BufferedReader;
import java.io.DataOutputStream;
import java.io.InputStreamReader;
import java.net.Socket;
import java.util.StringTokenizer;
import java.util.concurrent.TimeUnit; 
class TCPClient { 
	
	public static void main(String argv[]) throws Exception 
	{ 
		String sentence; 
		String inputSentence;
		String cmd;
		
		BufferedReader inFromUser = 
		new BufferedReader(new InputStreamReader(System.in)); 
		while (true){
			Socket clientSocket = new Socket("localhost", 6789); 
			
			DataOutputStream outToServer = 
			new DataOutputStream(clientSocket.getOutputStream()); 
			
			
			BufferedReader inFromServer = 
			new BufferedReader(new
				InputStreamReader(clientSocket.getInputStream())); 
			while (true){
				sentence = inFromUser.readLine(); 
								
				outToServer.writeBytes(sentence + '\n'); 
				
				inputSentence = inFromServer.readLine(); 
				
				System.out.println("FROM SERVER: " + inputSentence); 
				
				StringTokenizer tokenizedLine =	new StringTokenizer(sentence);
				cmd = tokenizedLine.nextToken();
				if (cmd.equals("DONE")){
					clientSocket.close();
					break;
				}
			}
			System.out.println("Re-opening connection");
			TimeUnit.SECONDS.sleep(1);
		}
			
	} 
} 
